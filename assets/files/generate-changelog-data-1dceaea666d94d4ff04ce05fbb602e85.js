#!/usr/bin/env node
const fs=require("fs"),path=require("path"),changelogDir=path.join(__dirname,"..","changelog"),outputFile=path.join(__dirname,"..","src","components","Changelog","changelog-data.json");function parseFrontmatter(t){const e=t.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/);if(!e)return{frontmatter:{},body:t};const n=e[1],i=e[2],r={};return n.split("\n").forEach(t=>{const e=t.trim();if(!e||e.startsWith("#"))return;const n=e.indexOf(":");if(-1===n)return;const i=e.substring(0,n).trim();let o=e.substring(n+1).trim();(o.startsWith('"')&&o.endsWith('"')||o.startsWith("'")&&o.endsWith("'"))&&(o=o.slice(1,-1)),r[i]=o}),{frontmatter:r,body:i}}function getSlugFromFilename(t){return t.replace(/\.md$/,"")}function scanDirectory(t,e=""){const n=[];if(!fs.existsSync(t))return n;const i=fs.readdirSync(t,{withFileTypes:!0});for(const r of i){const i=path.join(t,r.name),o=e?`${e}/${r.name}`:r.name;if(r.isDirectory())n.push(...scanDirectory(i,o));else if(r.isFile()&&r.name.endsWith(".md")&&"README.md"!==r.name){const t=fs.readFileSync(i,"utf-8"),{frontmatter:s}=parseFrontmatter(t);let c="development";if(e.includes("content"))c="content";else if(e.includes("development")||e.includes("infrastructure"))c="development";else if(""===e){c=(r.name.split("-")[2]||"").startsWith("content")?"content":"development"}const a=o.replace(/\.md$/,""),l={title:s.title||a,description:s.description||"",status:s.status||"planned",inception_date:s.inception_date||"",execution_date:s.execution_date||"TBD",type:s.type||"feature",component:s.component||void 0,priority:s.priority||"medium",category:s.category||c,slug:a};n.push(l)}}return n}function getAllChangelogEntries(){return fs.existsSync(changelogDir)?scanDirectory(changelogDir):(console.warn(`Changelog directory not found: ${changelogDir}`),[])}const entries=getAllChangelogEntries(),outputDir=path.dirname(outputFile);fs.existsSync(outputDir)||fs.mkdirSync(outputDir,{recursive:!0}),fs.writeFileSync(outputFile,JSON.stringify(entries,null,2),"utf-8"),console.log(`Generated changelog data: ${entries.length} entries written to ${outputFile}`);